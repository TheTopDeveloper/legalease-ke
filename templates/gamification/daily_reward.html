{% extends 'base.html' %}

{% block title %}Daily Rewards - Kenyan Legal Assistant{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/gamification.css') }}">
{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <div class="card shadow">
                <div class="card-body">
                    <h2 class="text-center mb-4">Daily Rewards</h2>
                    
                    <div class="streak-display mb-4">
                        <div class="streak-day">
                            {% if user_profile.streak_days >= 1 %}
                                <div class="streak-circle active">1</div>
                            {% else %}
                                <div class="streak-circle future">1</div>
                            {% endif %}
                            <span>Day 1</span>
                        </div>
                        <div class="streak-day">
                            <div class="streak-line {% if user_profile.streak_days >= 2 %}active{% endif %}"></div>
                            {% if user_profile.streak_days >= 2 %}
                                <div class="streak-circle active">2</div>
                            {% else %}
                                <div class="streak-circle future">2</div>
                            {% endif %}
                            <span>Day 2</span>
                        </div>
                        <div class="streak-day">
                            <div class="streak-line {% if user_profile.streak_days >= 3 %}active{% endif %}"></div>
                            {% if user_profile.streak_days >= 3 %}
                                <div class="streak-circle active">3</div>
                            {% else %}
                                <div class="streak-circle future">3</div>
                            {% endif %}
                            <span>Day 3</span>
                        </div>
                        <div class="streak-day">
                            <div class="streak-line {% if user_profile.streak_days >= 4 %}active{% endif %}"></div>
                            {% if user_profile.streak_days >= 4 %}
                                <div class="streak-circle active">4</div>
                            {% else %}
                                <div class="streak-circle future">4</div>
                            {% endif %}
                            <span>Day 4</span>
                        </div>
                        <div class="streak-day">
                            <div class="streak-line {% if user_profile.streak_days >= 5 %}active{% endif %}"></div>
                            {% if user_profile.streak_days >= 5 %}
                                <div class="streak-circle active">5</div>
                            {% else %}
                                <div class="streak-circle future">5</div>
                            {% endif %}
                            <span>Day 5</span>
                        </div>
                        <div class="streak-day">
                            <div class="streak-line {% if user_profile.streak_days >= 6 %}active{% endif %}"></div>
                            {% if user_profile.streak_days >= 6 %}
                                <div class="streak-circle active">6</div>
                            {% else %}
                                <div class="streak-circle future">6</div>
                            {% endif %}
                            <span>Day 6</span>
                        </div>
                        <div class="streak-day">
                            <div class="streak-line {% if user_profile.streak_days >= 7 %}active{% endif %}"></div>
                            {% if user_profile.streak_days >= 7 %}
                                <div class="streak-circle active">7</div>
                            {% else %}
                                <div class="streak-circle future">7</div>
                            {% endif %}
                            <span>Day 7</span>
                        </div>
                    </div>
                    
                    <div class="streak-info text-center mb-4">
                        <p>Current streak: <strong>{{ user_profile.streak_days }} days</strong></p>
                        <p>Longest streak: <strong>{{ user_profile.longest_streak }} days</strong></p>
                    </div>
                    
                    <div class="reward-box-container">
                        {% if can_claim %}
                            <div id="daily-reward-box" class="daily-reward-box">
                                <div class="reward-icon">
                                    <i class="bi bi-gift"></i>
                                </div>
                            </div>
                        {% else %}
                            <div id="daily-reward-box" class="daily-reward-box claimed">
                                <div class="reward-icon">
                                    <i class="bi bi-gift"></i>
                                </div>
                                <div class="reward-amount">
                                    <span class="tokens">Claimed!</span>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                    
                    <div id="reward-message" class="reward-message text-center">
                        {% if can_claim %}
                            Click the box to claim your daily reward!
                        {% else %}
                            You've already claimed today's reward. Come back tomorrow!
                        {% endif %}
                    </div>
                    
                    <div class="row mt-5">
                        <div class="col-md-6">
                            <div class="card mb-3">
                                <div class="card-header bg-primary text-white">
                                    <h5 class="mb-0">How Streaks Work</h5>
                                </div>
                                <div class="card-body">
                                    <p>Log in every day to maintain your streak. Each consecutive day increases your streak count.</p>
                                    <p>Longer streaks give you bonus tokens:</p>
                                    <ul>
                                        <li>3-day streak: +1 bonus token</li>
                                        <li>5-day streak: +2 bonus tokens</li>
                                        <li>7-day streak: +3 bonus tokens and an achievement</li>
                                    </ul>
                                    <p>Missing a day will reset your streak to 0.</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header bg-success text-white">
                                    <h5 class="mb-0">Tokens & Benefits</h5>
                                </div>
                                <div class="card-body">
                                    <p>Tokens can be used for premium features:</p>
                                    <ul>
                                        <li>AI-powered legal research</li>
                                        <li>Document generation and analysis</li>
                                        <li>Precedent searches</li>
                                        <li>Legal arguments generation</li>
                                    </ul>
                                    <p class="mb-0">Current balance: <strong>{{ current_user.tokens_available }} tokens</strong></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Sound effects -->
<audio id="reward-sound" src="{{ url_for('static', filename='sounds/reward.mp3') }}" preload="auto"></audio>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/gamification.js') }}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize daily rewards
        gamificationState.lastStreak = {{ user_profile.streak_days }};
        gamificationState.dailyRewardClaimed = {% if can_claim %}false{% else %}true{% endif %};
    });
</script>
{% endblock %}